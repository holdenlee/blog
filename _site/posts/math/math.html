<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <meta name="description" content="Holden Lee's Blog">
  <meta name="author" content="Holden Lee">
  <!-- If the page has tags, populate keywords. This doesn't work right now because tags is not raw text.-->
  <!-- <meta name="keywords" content=<a href="/tags/math.html">math</a>> -->
  <!-- link rel="icon" href="../../favicon.ico" -->
    
  <title>A Post With Math</title>

  <!-- Bootstrap core CSS -->
  <!-- This URL will be relativized. https://hackage.haskell.org/package/hakyll-4.7.5.0/docs/Hakyll-Web-Html-RelativizeUrls.html -->
  <link href="../../css/bootstrap.min.css" rel="stylesheet">

  <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
  <!-- <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet"> -->

  <!-- Custom styles for this template -->
  <!--link href="/css/starter-template.css" rel="stylesheet"-->
  <!--link href="../css/lavish-bootstrap.css" rel="stylesheet"-->
  <link href="../../css/blog2.css" rel="stylesheet">
  <!--link href="../css/no-transition.css" rel="stylesheet"-->
  <link href="../../css/default.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  
  <!-- Facebook -->
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
  <!-- Google -->
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  

</head>

<body>

<!-- Navigation bar. navbar-inverse is black, navbar-default is white.-->
<!-- To make a button active (pressed), use <li class="active"> -->
<div id="header">
  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../">Holden's Blog</a>
      </div>
      <div id="navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li><a href="../../">Home</a></li>
          <li><a href="../../sitemap.html">Sitemap</a></li>
          <li><a href="../../about.html">About</a></li>
<!-- TODO: make this part a for loop over main pages -->
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </nav>
</div>
<!-- Content -->
<!--div id="content">
  <h1>Mental Wilderness</h1>-->



<div class="container">
  <div id="content">
    <div class="page header">
      <h1>A Post With Math</h1>
    </div>
    <div class="info">
       <div class="subtitle"><p>Can I render math?</p></div> 
       
        <p>Posted: 2015-01-02 
          
	</p>
      
       <p>Tags: <a href="../../tags/math.html">math</a></p> 
    </div>
    
  </div>
  <!--/div-->

  <div class="blog-main">
    <p>See my <a href="2015-01-01-hello-world.html">first post</a>.</p>
<p>This is math:</p>
<p><span class="math display">\[ \int_1^x \frac{1}{u}\,du = \ln x.\]</span></p>
<p>More math:</p>
<p><span class="math display">\[
\pi = 4\sum_{n=0}^{\infty} (-1)^n \fc{1}{2n+1}
\]</span></p>
<p>Inline: <span class="math inline">\(a^p\equiv a \pmod{p}\)</span>.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>Macro: <span class="math inline">\(\fc{1}{2}\)</span></p>
<p>This is a reference:</p>
<p>Text: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
<p>Haskell code:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="co">{-# OPTIONS</span>
<span class="co">    -XPatternSynonyms</span>
<span class="co">    -XTemplateHaskell</span>
<span class="co">#-}</span>

<span class="kw">module</span> <span class="dt">CYK</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Control.Lens</span>
<span class="kw">import </span><span class="dt">Control.Monad</span>
<span class="kw">import </span><span class="dt">Control.Monad.Free</span>
<span class="co">--import Control.Monad.Trans.RWS.Lazy</span>
<span class="kw">import </span><span class="dt">Control.Monad.Trans.State.Lazy</span>
<span class="co">--import Control.Monad.Trans.Writer.Lazy</span>
<span class="kw">import qualified</span> <span class="dt">Data.Array</span> <span class="kw">as</span> <span class="dt">A</span>
<span class="kw">import </span><span class="dt">Data.Either</span>
<span class="kw">import qualified</span> <span class="dt">Data.Map</span> <span class="kw">as</span> <span class="dt">M</span>
<span class="kw">import </span><span class="dt">Data.Maybe</span>
<span class="kw">import qualified</span> <span class="dt">Data.MultiMap</span> <span class="kw">as</span> <span class="dt">MM</span>
<span class="co">--import Data.Tree as T</span>
<span class="kw">import </span><span class="dt">Utilities</span>
<span class="co">--https://github.com/holdenlee/haskell-utilities</span>

<span class="co">--type WS w s = RWST () w s</span>

<span class="co">{-| Array helpers -}</span>
<span class="ot">fillArray ::</span> (<span class="dt">A.Ix</span> i) <span class="ot">=&gt;</span> (i,i) <span class="ot">-&gt;</span> e <span class="ot">-&gt;</span> <span class="dt">A.Array</span> i e
fillArray (lo,hi) <span class="fu">=</span>
   A.listArray (lo, hi) <span class="fu">.</span> repeat

<span class="kw">instance</span> (<span class="dt">Show</span> k, <span class="dt">Show</span> a) <span class="ot">=&gt;</span> <span class="dt">Show</span> (<span class="dt">MM.MultiMap</span> k a) <span class="kw">where</span>
  show <span class="fu">=</span> show <span class="fu">.</span> MM.toMap

<span class="co">{-</span>
<span class="co">aset :: (Ix i) =&gt; i -&gt; e -&gt; Array i e -&gt; Array i e</span>
<span class="co">aset i e = (//[(i,e)])-}</span>

<span class="co">{-| Data types -}</span>

<span class="kw">type</span> <span class="dt">Symbol</span> <span class="fu">=</span> <span class="dt">Either</span>

pattern <span class="dt">Nonterminal</span> a <span class="fu">=</span> <span class="dt">Left</span> a 
pattern <span class="dt">Terminal</span> t <span class="fu">=</span> <span class="dt">Right</span> t

<span class="co">--type Grammar a = M.Map a [Symbol a]</span>
<span class="kw">data</span> <span class="dt">CNFGrammar</span> a t <span class="fu">=</span> <span class="dt">CNFGrammar</span> {_<span class="ot">unitProds ::</span> [(a, t)],
                                  _<span class="ot">prods ::</span> [(a, [a])],
                                  _<span class="ot">charMap ::</span> <span class="dt">MM.MultiMap</span> t <span class="dt">Int</span>} <span class="kw">deriving</span> <span class="dt">Show</span>

makeLenses <span class="ch">''</span><span class="dt">CNFGrammar</span>

<span class="ot">initCNF ::</span> (<span class="dt">Ord</span> t) <span class="ot">=&gt;</span> [(a, t)] <span class="ot">-&gt;</span> [(a, [a])] <span class="ot">-&gt;</span> <span class="dt">CNFGrammar</span> a t
initCNF p1 p2 <span class="fu">=</span>
  <span class="dt">CNFGrammar</span> {_unitProds <span class="fu">=</span> p1,
              _prods <span class="fu">=</span> p2,
              _charMap <span class="fu">=</span> for' (zenumerate p1) MM.empty (\(i,(_,r)) <span class="ot">-&gt;</span> MM.insert r i)}

<span class="kw">type</span> <span class="dt">ProdTable</span> a t <span class="fu">=</span> <span class="dt">A.Array</span> (<span class="dt">Int</span>, <span class="dt">Int</span>) (<span class="dt">MM.MultiMap</span> a (<span class="dt">Either</span> (<span class="dt">Int</span>, [a]) t))

<span class="co">{-| CYK parse -}</span>
<span class="ot">cykParse' ::</span> (<span class="dt">Ord</span> a, <span class="dt">Ord</span> t) <span class="ot">=&gt;</span> [t] <span class="ot">-&gt;</span> <span class="dt">CNFGrammar</span> a t <span class="ot">-&gt;</span> <span class="dt">State</span> (<span class="dt">ProdTable</span> a t) <span class="dt">Bool</span>
cykParse' str grammar <span class="fu">=</span> <span class="kw">do</span>
  <span class="kw">let</span> n <span class="fu">=</span> (length str)
  put (fillArray ((<span class="dv">1</span>, <span class="dv">0</span>),(n, n <span class="fu">-</span> <span class="dv">1</span>)) MM.empty)
  <span class="co">--for all characters in the string [t]</span>
  forM_ [<span class="dv">0</span><span class="fu">..</span>(n<span class="fu">-</span><span class="dv">1</span>)] (\i <span class="ot">-&gt;</span> 
    <span class="co">--for each unit production rule r -&gt; t</span>
    forM_ (MM.lookup (str<span class="fu">!!</span>i) (grammar <span class="fu">^.</span> charMap)) (\j <span class="ot">-&gt;</span>
      <span class="kw">let</span> (r,t) <span class="fu">=</span> (grammar <span class="fu">^.</span> unitProds)<span class="fu">!!</span>j
      <span class="kw">in</span> modify (ix (<span class="dv">1</span>,i) <span class="fu">%~</span> MM.insert r (<span class="dt">Terminal</span> t))                                             <span class="co">{-</span>
<span class="co">    forM_ (grammar ^. unitProds) (\(r, t) -&gt; </span>
<span class="co">      --set P[1,i,r] to point to the character</span>
<span class="co">      if t == str!!i</span>
<span class="co">         then modify (ix (1, i) %~ MM.insert r (Terminal t))</span>
<span class="co">         else return ()-}</span>
      )
    )
  <span class="co">--for each possible length of span</span>
  forM_ [<span class="dv">2</span><span class="fu">..</span>n] (\i <span class="ot">-&gt;</span>
    <span class="co">--for each possible start of span</span>
    forM_ [<span class="dv">0</span><span class="fu">..</span>(n<span class="fu">-</span>i)] (\j <span class="ot">-&gt;</span>
      <span class="co">--for each possible partition of span</span>
      forM_ [<span class="dv">1</span><span class="fu">..</span>(i<span class="fu">-</span><span class="dv">1</span>)] (\k <span class="ot">-&gt;</span>
        <span class="co">--for each production rule</span>
        forM_ (grammar <span class="fu">^.</span> prods) (\(a,[b,c]) <span class="ot">-&gt;</span>
          modify (\p <span class="ot">-&gt;</span> <span class="kw">if</span> MM.member (p <span class="fu">A.!</span> (k,j)) b <span class="fu">&amp;&amp;</span> MM.member (p <span class="fu">A.!</span> (i<span class="fu">-</span>k,j<span class="fu">+</span>k)) c
                        <span class="kw">then</span> p <span class="fu">&amp;</span> ix (i,j) <span class="fu">%~</span> MM.insert a (<span class="dt">Nonterminal</span> (k,[b,c]))
                        <span class="kw">else</span> p)
          )
        )
      )
    )
  p <span class="ot">&lt;-</span> get
  return (not <span class="fu">$</span> MM.null (p <span class="fu">A.!</span> (n,<span class="dv">0</span>)))
  
gr <span class="fu">=</span> initCNF     [(<span class="st">&quot;VP&quot;</span>,<span class="st">&quot;eats&quot;</span>),
                  (<span class="st">&quot;NP&quot;</span>,<span class="st">&quot;she&quot;</span>),
                  (<span class="st">&quot;V&quot;</span>,<span class="st">&quot;eats&quot;</span>),
                  (<span class="st">&quot;P&quot;</span>,<span class="st">&quot;with&quot;</span>),
                  (<span class="st">&quot;N&quot;</span>,<span class="st">&quot;artichoke&quot;</span>),
                  (<span class="st">&quot;N&quot;</span>,<span class="st">&quot;fork&quot;</span>),
                  (<span class="st">&quot;Det&quot;</span>,<span class="st">&quot;an&quot;</span>),
                  (<span class="st">&quot;Det&quot;</span>,<span class="st">&quot;a&quot;</span>)]
                 [(<span class="st">&quot;S&quot;</span>, [<span class="st">&quot;NP&quot;</span>,<span class="st">&quot;VP&quot;</span>]),
                  (<span class="st">&quot;VP&quot;</span>, [<span class="st">&quot;VP&quot;</span>,<span class="st">&quot;PP&quot;</span>]),
                  (<span class="st">&quot;VP&quot;</span>, [<span class="st">&quot;V&quot;</span>,<span class="st">&quot;NP&quot;</span>]),
                  (<span class="st">&quot;PP&quot;</span>, [<span class="st">&quot;P&quot;</span>,<span class="st">&quot;NP&quot;</span>]),
                  (<span class="st">&quot;NP&quot;</span>, [<span class="st">&quot;Det&quot;</span>,<span class="st">&quot;N&quot;</span>]),
<span class="co">--let's add some ambiguity</span>
                  (<span class="st">&quot;NP&quot;</span>, [<span class="st">&quot;NP&quot;</span>,<span class="st">&quot;PP&quot;</span>])]

sent <span class="fu">=</span> words <span class="st">&quot;she eats an artichoke with a fork&quot;</span>

parsed <span class="fu">=</span> runState (cykParse' sent gr) undefined

<span class="kw">data</span> <span class="dt">LabeledList</span> a t <span class="fu">=</span> <span class="dt">LabeledList</span> a [t] <span class="kw">deriving</span> <span class="dt">Show</span>

<span class="kw">type</span> <span class="dt">LabTree</span> a <span class="fu">=</span> <span class="dt">Free</span> (<span class="dt">LabeledList</span> a)

pattern <span class="dt">LabTree</span> a t <span class="fu">=</span> <span class="dt">Free</span> (<span class="dt">LabeledList</span> a t)

<span class="co">{-| Given the start, the length, and the type -}</span>
<span class="ot">parsings' ::</span> (<span class="dt">Ord</span> a) <span class="ot">=&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">ProdTable</span> a t <span class="ot">-&gt;</span> [<span class="dt">LabTree</span> a t]
parsings' len i a pt <span class="fu">=</span> <span class="kw">do</span>
  st <span class="ot">&lt;-</span> MM.lookup a (fromMaybe MM.empty (pt <span class="fu">^?</span> ix (len, i)))
  <span class="co">--format is Either (Int, [a]) t</span>
  <span class="kw">case</span> st <span class="kw">of</span>
   <span class="dt">Nonterminal</span> (k,[l,r]) <span class="ot">-&gt;</span>
     map (<span class="dt">LabTree</span> a) <span class="fu">$</span> (\x y <span class="ot">-&gt;</span> [x,y]) <span class="fu">&lt;$&gt;</span> parsings' k i l pt <span class="fu">&lt;*&gt;</span> parsings' (len<span class="fu">-</span>k) (i<span class="fu">+</span>k) r pt
   <span class="dt">Terminal</span> term <span class="ot">-&gt;</span>
     [<span class="dt">LabTree</span> a [<span class="dt">Pure</span> term]]

<span class="ot">parsings ::</span> (<span class="dt">Ord</span> a) <span class="ot">=&gt;</span> <span class="dt">ProdTable</span> a t <span class="ot">-&gt;</span> [<span class="dt">LabTree</span> a t]
parsings pt <span class="fu">=</span>
  <span class="kw">let</span>
    len <span class="fu">=</span> fst <span class="fu">$</span> snd (A.bounds pt)
  <span class="kw">in</span>
   <span class="co">--for all the possible symbols...</span>
   foldMap (\x <span class="ot">-&gt;</span> parsings' len <span class="dv">0</span> x pt) (MM.keys (pt <span class="fu">A.!</span> (len, <span class="dv">0</span>)))
     
ans <span class="fu">=</span> parsings <span class="fu">$</span> execState (cykParse' sent gr) undefined</code></pre></div>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>This is a footnote.<a href="#fnref1">↩</a></p></li>
</ol>
</section>
  </div>
  

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
    this.page.url = http://holdenlee.github.io/blog/posts/math/math.html; // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = /posts/math/math.html; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');

    s.src = '//holdenlee.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  <div class="sharing">
    <!-- facebook -->
    <div class="fb-share-button" data-href="/posts/math/math.html" data-layout="icon"></div>
    <!-- google -->
    <div class="g-plus" data-action="share"></div>
    <!-- reddit -->
    <a href="//www.reddit.com/submit" onclick="window.location = '//www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false"> <img src="//www.redditstatic.com/spreddit1.gif" alt="submit to reddit" border="0" /> </a>
    <!-- twitter -->
    <a href="https://twitter.com/share" class="twitter-share-button" {count}>Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
  </div>
  
</div>


<!-- Footer -->
<div id="footer">
  <div class="container">
    Built with
    <a href="http://jaspervdj.be/hakyll">Hakyll</a> 
    using 
    <a href="http://www.getbootstrap.com">Bootstrap</a>, 
    <a href="http://www.mathjax.org">MathJax</a>, 
    <a href="http://www.disqus.com">Disqus</a>,
    <a href="http://highlightjs.org/">Highlight.js</a>, and 
    <a href="http://ignorethecode.net/blog/2010/04/20/footnotes/">Footnotes.js</a>
  </div>
</div>
</body>

</html>

<!-- SCRIPTS -->
<!-- jQuery-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

<script src="../../js/bootstrap.min.js"></script>

<!-- Extension : Highlight.js @ https://highlightjs.org/ -->
<!-- Syntax highlighting tomorrow-night-bright, agate-->
<link rel="stylesheet" href="../../highlight/styles/tomorrow-night-bright.css">
<script src="../../highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<!-- Extension : MathJax @ https://docs.mathjax.org/en/v2.5-latest/tex.html -->
<!-- MathJax/config/local/local.js contains macros. Need to provide entire URL-->
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML,http://holdenlee.github.io/blog/MathJax/config/local/local"></script>

<!-- Extension : Footnotes @ http://ignorethecode.net/blog/2010/04/20/footnotes/ -->
<script src="../../js/footnotes.js"></script>



